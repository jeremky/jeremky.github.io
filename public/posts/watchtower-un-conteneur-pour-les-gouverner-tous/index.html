<!DOCTYPE html>
<html lang="fr">
  <head>
    
      <title>
        Watchtower : un conteneur pour les gouverner tous ::
        JeremKy.fr
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Docker est un outil incroyable qui permet de déployer facilement tout un tas de solutions logicielles. Grâce à lui, pas besoin de vous soucier de l&rsquo;OS, de sa version, et des risques d&rsquo;une mauvaise installation à cause des différentes opérations manuelles à effectuer, le tout étant déjà préparé dans les images que vous déployez.
De plus, lorsque vous êtes amené à mettre vos applications à jour, vous pouviez être confronté à effectuer des opérations fastidieuses. Grâce à Docker, il suffit de récupérer la dernière version d’une image et le tour est joué.
"
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://www.jeremky.fr/posts/watchtower-un-conteneur-pour-les-gouverner-tous/" />







<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="https://www.jeremky.fr/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.jeremky.fr/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="https://www.jeremky.fr/img/favicon.png" />


<link href="/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Watchtower : un conteneur pour les gouverner tous">
  <meta name="twitter:description" content="Docker est un outil incroyable qui permet de déployer facilement tout un tas de solutions logicielles. Grâce à lui, pas besoin de vous soucier de l’OS, de sa version, et des risques d’une mauvaise installation à cause des différentes opérations manuelles à effectuer, le tout étant déjà préparé dans les images que vous déployez.
De plus, lorsque vous êtes amené à mettre vos applications à jour, vous pouviez être confronté à effectuer des opérations fastidieuses. Grâce à Docker, il suffit de récupérer la dernière version d’une image et le tour est joué.">



<meta property="og:url" content="https://www.jeremky.fr/posts/watchtower-un-conteneur-pour-les-gouverner-tous/">
  <meta property="og:site_name" content="JeremKy.fr">
  <meta property="og:title" content="Watchtower : un conteneur pour les gouverner tous">
  <meta property="og:description" content="Docker est un outil incroyable qui permet de déployer facilement tout un tas de solutions logicielles. Grâce à lui, pas besoin de vous soucier de l’OS, de sa version, et des risques d’une mauvaise installation à cause des différentes opérations manuelles à effectuer, le tout étant déjà préparé dans les images que vous déployez.
De plus, lorsque vous êtes amené à mettre vos applications à jour, vous pouviez être confronté à effectuer des opérations fastidieuses. Grâce à Docker, il suffit de récupérer la dernière version d’une image et le tour est joué.">
  <meta property="og:locale" content="fr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-25T17:28:32+00:00">
    <meta property="article:modified_time" content="2024-06-25T17:28:32+00:00">
    <meta property="article:tag" content="Admin">
    <meta property="article:tag" content="Docker">






  </head>
  <body >
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >JEREMKY.FR</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/apropos">A propos</a></li>
        
      
        
          <li><a href="/archives">Archives</a></li>
        
      
        
          <li><a href="/categories/news">News</a></li>
        
      
        
          <li><a href="/categories/tutos">Tutos</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/apropos">A propos</a></li>
      
    
      
        <li><a href="/archives">Archives</a></li>
      
    
      
        <li><a href="/categories/news">News</a></li>
      
    
      
        <li><a href="/categories/tutos">Tutos</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <article class="post">
    <h1 class="post-title">Watchtower : un conteneur pour les gouverner tous</h1>
    <div class="post-meta">
      
        <time class="post-date">
          25/06/2024
        </time>

        
          
        
      

      


      
        <span class="post-read-time"
          >— 2 min de lecture</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="https://www.jeremky.fr/tags/admin/">#admin</a>&nbsp;
        
          <a href="https://www.jeremky.fr/tags/docker/">#docker</a>&nbsp;
        
      </span>
    

    
      <figure class="post-cover">
  
    <img src="https://www.jeremky.fr/img/posts/watchtower-un-conteneur-pour-les-gouverner-tous/cover.webp" alt="Watchtower : un conteneur pour les gouverner tous" width="700" />
  

  
</figure>

    

    <div class="post-content">
      
      <p>Docker est un outil incroyable qui permet de déployer facilement tout un tas de solutions logicielles. Grâce à lui, pas besoin de vous soucier de l&rsquo;OS, de sa version, et des risques d&rsquo;une mauvaise installation à cause des différentes opérations manuelles à effectuer, le tout étant déjà préparé dans les images que vous déployez.</p>
<p>De plus, lorsque vous êtes amené à mettre vos applications à jour, vous pouviez être confronté à effectuer des opérations fastidieuses. Grâce à Docker, il suffit de récupérer la dernière version d’une image et le tour est joué.</p>
<p>Mais&hellip; Imaginez qu&rsquo;il soit possible de ne plus avoir à vous préoccuper même de ces opérations de mise à jour d’image, afin d’avoir automatiquement vos conteneurs à jour. C’est là que Watchtower intervient.</p>
<h2 id="fonctionnalités">
  Fonctionnalités
  <a href="#fonctionnalit%c3%a9s" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p><a href="https://containrrr.dev/watchtower/">Watchtower</a> est un outil capable de vérifier les images actuellement utilisées sur votre instance Docker. En fonction de la façon dont vous le configurez, il peut soit vous notifier que des nouvelles versions d&rsquo;image sont disponibles, soit les mettre à jour automatiquement, en choisissant une fréquence de vérification, ou une date et heure précise.</p>
<p>C&rsquo;est cette seconde méthode que je vais vous proposer de mettre en place, afin de redémarrer automatiquement sur la dernière version vos conteneurs à une heure désirée.</p>
<h2 id="installation">
  Installation
  <a href="#installation" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Pour installer Watchtower, comme d&rsquo;habitude, on commence par un fichier <code>docker-compose.yml</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">watchtower</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">containrrr/watchtower:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">watchtower</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">watchtower</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env_file</span>: <span style="color:#ae81ff">watchtower.env</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span></code></pre></div><p>Et son fichier <code>watchtower.env</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>TZ=Europe/Paris
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WATCHTOWER_SCHEDULE=0 0 6 * * *
</span></span><span style="display:flex;"><span>WATCHTOWER_LABEL_ENABLE=false
</span></span><span style="display:flex;"><span>WATCHTOWER_CLEANUP=true
</span></span><span style="display:flex;"><span>WATCHTOWER_REMOVE_VOLUMES=true
</span></span><span style="display:flex;"><span>#WATCHTOWER_DISABLE_CONTAINERS=
</span></span></code></pre></div><p>Petit tour des variables que j’utilise :</p>
<ul>
<li><code>WATCHTOWER_SCHEDULE</code> : permet de définir le moment du check à la manière de cron. Tous les jours à 6h dans notre exemple</li>
<li><code>WATCHTOWER_LABEL_ENABLE</code> : il est par défaut nécessaire d&rsquo;indiquer dans chaque fichier docker-compose si le conteneur doit être vérifié. Désactivé dans notre cas pour plus de simplicité</li>
<li><code>WATCHTOWER_CLEANUP</code> : nettoie ou non les anciennes images une fois la mise à jour effectuée</li>
<li><code>WATCHTOWER_REMOVE_VOLUMES</code> : supprime les volumes qui ne sont pas nommés</li>
<li><code>WATCHTOWER_DISABLE_CONTAINERS</code> : permet lister les conteneurs à exclure de la vérification (séparé par des espaces)</li>
</ul>
<p>Si vous avez besoin de précisions sur ces paramètres, les infos se trouvent principalement <a href="https://containrrr.dev/watchtower/arguments/">ici</a>.</p>
<p>Petite capture des logs d&rsquo;une instance en place, avec deux exemples d&rsquo;images mises à jour :</p>

  <img src="/img/posts/watchtower-un-conteneur-pour-les-gouverner-tous/logs.webp"  class="center"  style="border-radius: 8px;"  />



    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Autres posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.jeremky.fr/posts/retour-sur-le-generateur-de-site-hugo/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Retour sur le générateur de site Hugo</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://www.jeremky.fr/posts/mise-en-place-dun-vpn-avec-wireguard/">
                  <span class="button__text">Mise en place d&#39;un VPN avec Wireguard</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </article>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >JEREMKY.FR</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
          <div class="copyright">
        <span>© 2025 Propulsé par <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
      </div>
    
  </div>
</footer>





<script type="text/javascript" src="/bundle.min.js"></script>


      
    </div>

    
  </body>
</html>
